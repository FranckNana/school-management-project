<div class="dashboard-container" [@fadeInUp]>
  <!-- HEADER -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <h1>Tableau de Bord</h1>
        <div class="date-info">
          {{ today | date:'EEEE d MMMM yyyy' }}
        </div>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="addStudent()">
          <mat-icon>add</mat-icon> Nouvel √©l√®ve
        </button>
        <button mat-raised-button color="accent" (click)="goToSchedule()">
          <mat-icon>calendar_today</mat-icon> Planning
        </button>
        <button mat-raised-button>
          <mat-icon>print</mat-icon> Rapport
        </button>
      </div>
    </div>
  </div>

  <!-- STATS -->
  <div class="dashboard-stats" [@statsAnimation]>
    <mat-card class="stats-card purple">
      <div class="stats-card-bg" style="background-image: url('https://img.freepik.com/free-vector/college-students-concept-illustration_114360-10205.jpg?w=500')"></div>
      <mat-card-content>
        <div class="icon-container"><mat-icon>school</mat-icon></div>
        <div class="stats-info"><h2>{{metrics?.totalStudents }}</h2><p>√âl√®ve(s) inscrit(s)</p></div>
        <div class="stats-footer">
          <span class="trend positive" *ngIf="(metrics?.comparedStudent ?? 0) > 0">
            <mat-icon>trending_up</mat-icon>{{metrics?.comparedStudent ?? 0}} Etudent(s) de plus que l'an pass√©
          </span>
          <span class="trend neutral" *ngIf="(metrics?.comparedStudent ?? 0) === 0">
            <mat-icon>trending_flat</mat-icon> Stable
          </span>
          <span class="trend negative" *ngIf="(metrics?.comparedStudent ?? 0) < 0">
            <mat-icon>trending_down</mat-icon> {{ metrics?.comparedStudent ?? 0 }} Etudiant(s) de moins que l'an pass√©
          </span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card blue">
      <div class="stats-card-bg" style="background-image: url('https://img.freepik.com/free-vector/teacher-concept-illustration_114360-1638.jpg?w=500')"></div>
      <mat-card-content>
        <div class="icon-container"><mat-icon>people</mat-icon></div>
        <div class="stats-info"><h2>{{metrics?.totalTeachers ?? 0 }}</h2><p>Enseignant(s)</p></div>
        <div class="stats-footer">
          <span class="trend positive" *ngIf="(metrics?.comparedTeacher ?? 0) > 0">
            <mat-icon>trending_up</mat-icon> A la hausse
          </span>
          <span class="trend neutral" *ngIf="(metrics?.comparedTeacher ?? 0 )=== 0">
            <mat-icon>trending_flat</mat-icon> Stable
          </span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card green">
      <div class="stats-card-bg" style="background-image: url('https://img.freepik.com/free-vector/payment-information-concept-illustration_114360-5352.jpg?w=500')"></div>
      <mat-card-content>
        <div class="icon-container"><mat-icon>payments</mat-icon></div>
        <div class="stats-info"><h2>{{metrics?.paymentComplianceRate ?? 0 | number:'1.2-2'}}%</h2><p>Paiements √† jour</p></div>
        <div class="stats-footer">
          <!-- <span class="trend positive"><mat-icon>trending_up</mat-icon> +10% ce mois</span> -->
           <span class="trend neutral"><mat-icon>trending_flat</mat-icon> Stable</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stats-card orange">
      <div class="stats-card-bg" style="background-image: url('https://img.freepik.com/free-vector/schedule-concept-illustration_114360-1531.jpg?w=500')"></div>
      <mat-card-content>
        <div class="icon-container"><mat-icon>event</mat-icon></div>
        <div class="stats-info"><h2>{{metrics?.todaysClassesCount ?? 0}}</h2><p>Cours aujourd‚Äôhui</p></div>
        <div class="stats-footer">
          <span class="trend neutral"><mat-icon>schedule</mat-icon> {{nbCoursDispensesActuellement}} en cours</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- EMPLOI DU TEMPS -->
  <div class="dashboard-content">
    <div class="row">
      <div class="col-md-8">
      <mat-card class="schedule-card modern-schedule">
        <mat-card-header>
          <mat-card-title>
            <div class="card-title-content">
              <div class="icon-container">
                <mat-icon>schedule</mat-icon>
              </div>
              <span>Emploi du temps du jour ({{todaySchedule.length}})</span>
            </div>
          </mat-card-title>
        </mat-card-header>

        <mat-card-content class="dash-container">
          <ng-container *ngIf="todaySchedule && todaySchedule.length > 0; else noSchedule">
            <div class="modern-schedule-grid">
              <div *ngFor="let item of todaySchedule" class="course-card" [ngStyle]="{'background': getCourseColor(item.matiere)}">
                <div class="course-header">
                  <div class="course-time">
                    <mat-icon>{{ getCourseIcon(item.matiere) }}</mat-icon>
                    {{item.heureDebut}} - {{item.heureFin}}
                  </div>
                  <div class="course-status" [ngClass]="getCourseStatus(item)">
                    {{ getCourseStatus(item) }}
                  </div>
                </div>
                <div class="course-body">
                  <h3>{{item.matiere}}</h3>
                  <p>{{item.classe}}</p>
                  <small>{{item.enseignant}}</small>
                </div>
              </div>
            </div>
          </ng-container>

          <ng-template #noSchedule>
            <div class="no-schedule-container" [@fadeInUp]>
              <img src="assets/no_schedule.jpg" alt="Aucun cours" class="no-schedule-img" />
              <mat-icon class="no-schedule-icon">event_busy</mat-icon>
              <p>Aucun cours pr√©vu pour aujourd‚Äôhui üéâ</p>
            </div>
          </ng-template>
        </mat-card-content>
      </mat-card>
    </div>

      <div class="col-md-4">
        <!-- Notifications -->
        <mat-card class="notifications-card" [@notificationAnimation]>
          <mat-card-header class="notification-header">
            <div class="card-title-content">
              <div class="icon-container">
                <mat-icon>notifications</mat-icon>
              </div>
              <span> √âv√©nementss ({{notifications.length}})</span>
            </div>

            <div style="margin-left: auto">
              <button mat-mini-fab color="primary" (click)="openAddNotificationDialog()" matTooltip="Ajouter un √©v√©nement">
                <mat-icon>add</mat-icon>
              </button>
            </div>
            
          </mat-card-header>

          <mat-card-content>
            <!-- Si aucune notification -->
            <div *ngIf="notifications.length === 0" class="no-notification">
              <img src="https://cdn-icons-png.flaticon.com/512/4076/4076549.png" alt="Aucune notification" class="empty-illustration" />
              <p>Aucune notification pour le moment</p>
              <button mat-stroked-button color="primary" (click)="openAddNotificationDialog()">
                <mat-icon>add</mat-icon> Ajouter un √©v√©nement
              </button>
            </div>

            <!-- ‚úÖ Scroll interne pour les notifications -->
            <div *ngIf="notifications.length > 0" class="notifications-list scrollable">
              <div *ngFor="let notif of notifications" class="notification-item" [style.borderLeft]="'5px solid ' + notif.color">
                <mat-icon [style.color]="notif.color">{{ notif.icon }}</mat-icon>
                <div class="notification-content">
                  <strong>{{ notif.title }}</strong>
                  <p *ngIf="notif.description">{{ notif.description }}</p>
                  <small>{{ notif.dateTime | date:'EEEE d MMMM yyyy √† HH:mm' }}</small>
                </div>
                <div class="notification-actions">
                  <button mat-icon-button color="warn" (click)="deleteNotification(notif)" matTooltip="Supprimer">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>

</div>
